<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Price Visualization</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f7fa;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      padding: 20px;
    }
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .chart-title {
      font-size: 22px;
      font-weight: 600;
      margin: 0;
    }
    <!-- Only the data type selector remains -->
    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    select, button {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #d1d5db;
      background-color: #fff;
      font-size: 14px;
      cursor: pointer;
    }
    select:focus, button:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
    }
    button {
      background-color: #2563eb;
      color: #fff;
      border: none;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #1d4ed8;
    }
    .timeframe-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    .timeframe-button {
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #d1d5db;
      background-color: #f9fafb;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      color: #333;
    }
    .timeframe-button:hover {
      background-color: #e2e8f0;
    }
    .timeframe-button.active {
      background-color: #2563eb;
      color: #fff;
      border-color: #2563eb;
      font-weight: 600;
      box-shadow: 0 0 5px rgba(37, 99, 235, 0.5);
    }
    .chart-container {
      position: relative;
      height: 400px;
      margin-bottom: 20px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .stat-card {
      background-color: #f9fafb;
      border-radius: 6px;
      padding: 15px;
    }
    .stat-label {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 5px;
    }
    .stat-value {
      font-size: 18px;
      font-weight: 600;
    }
    .positive {
      color: #16a34a;
    }
    .negative {
      color: #dc2626;
    }
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .data-table th {
      background-color: #f9fafb;
      text-align: left;
      padding: 10px;
      font-weight: 600;
      border-bottom: 1px solid #e5e7eb;
    }
    .data-table td {
      padding: 10px;
      border-bottom: 1px solid #e5e7eb;
    }
    .data-table th:not(:first-child),
    .data-table td:not(:first-child) {
      text-align: right;
    }
    .loading {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 16px;
      font-weight: 500;
    }
    .hidden {
      display: none;
    }
    .pagination {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-top: 10px;
    }
    .pagination button {
      padding: 5px 10px;
      border-radius: 4px;
      background-color: #f3f4f6;
      color: #374151;
      border: none;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .pagination button.active {
      background-color: #2563eb;
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="chart-header">
      <h1 class="chart-title">Stock Price Chart</h1>
      <!-- Removed chart type selector; only the data type selector remains -->
      <div class="controls">
        <select id="dataType">
          <option value="close">Close Price</option>
          <option value="open">Open Price</option>
          <option value="high">High Price</option>
          <option value="low">Low Price</option>
        </select>
      </div>
    </div>

    <div class="timeframe-buttons">
      <button class="timeframe-button active" data-days="30">1M</button>
      <button class="timeframe-button" data-days="90">3M</button>
      <button class="timeframe-button" data-days="180">6M</button>
      <button class="timeframe-button" data-days="365">1Y</button>
      <button class="timeframe-button" data-days="730">2Y</button>
      <button class="timeframe-button" data-days="1825">5Y</button>
      <button class="timeframe-button" data-days="all">All</button>
    </div>

    <div class="chart-container">
      <canvas id="stockChart"></canvas>
      <div id="loadingIndicator" class="loading hidden">Loading chart data...</div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Period High</div>
        <div class="stat-value" id="periodHigh">$0.00</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Period Low</div>
        <div class="stat-value" id="periodLow">$0.00</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Average Volume</div>
        <div class="stat-value" id="avgVolume">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Period Change</div>
        <div class="stat-value" id="periodChange">0.00%</div>
      </div>
    </div>

    <h2>Recent Price Data</h2>
    <div style="overflow-x: auto;">
      <table class="data-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Open</th>
            <th>High</th>
            <th>Low</th>
            <th>Close</th>
            <th>Volume</th>
            <th>Change %</th>
          </tr>
        </thead>
        <tbody id="dataTableBody">
          <!-- Data rows will be inserted here -->
        </tbody>
      </table>
    </div>

    <div class="pagination" id="pagination">
      <!-- Pagination buttons will be inserted here -->
    </div>
  </div>

  <!-- Include Chart.js and Luxon for date handling -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/luxon/3.0.1/luxon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-adapter-luxon/1.2.0/chartjs-adapter-luxon.min.js"></script>
  
  <script>
    // Initialize chart variables
    let stockChart;
    let fullData = [];
    let displayData = [];
    let currentPage = 1;
    const rowsPerPage = 10;
    
    // Sample data provided in the question
    const initialData = [
      { "close": 5.42, "date": "2020-01-02", "high": 5.46, "low": 5.23, "open": 5.35, "volume": 10258900 },
      { "close": 5.61, "date": "2020-01-03", "high": 5.65, "low": 5.46, "open": 5.46, "volume": 13293700 },
      { "close": 5.39, "date": "2020-01-06", "high": 5.58, "low": 5.39, "open": 5.5, "volume": 6176400 },
      { "close": 5.58, "date": "2020-01-07", "high": 5.61, "low": 5.46, "open": 5.46, "volume": 7404500 },
      { "close": 5.39, "date": "2020-01-08", "high": 5.54, "low": 5.35, "open": 5.5, "volume": 4179000 },
      { "close": 5.73, "date": "2020-01-09", "high": 5.73, "low": 5.46, "open": 5.5, "volume": 6574600 },
      { "close": 5.73, "date": "2020-01-10", "high": 5.77, "low": 5.61, "open": 5.69, "volume": 7214100 },
      { "close": 5.8, "date": "2020-01-13", "high": 5.88, "low": 5.65, "open": 5.77, "volume": 6922800 },
      { "close": 5.58, "date": "2020-01-14", "high": 5.84, "low": 5.5, "open": 5.8, "volume": 9230600 },
      { "close": 5.58, "date": "2020-01-15", "high": 5.65, "low": 5.54, "open": 5.58, "volume": 4217600 }
    ];
    
    // Generate more data to simulate multi-year dataset
    function generateHistoricalData() {
      const startDate = new Date('2020-01-02');
      const endDate = new Date('2025-03-18'); // Current date
      
      let currentDate = new Date(startDate);
      let previousClose = 5.58; // Last value from initial data
      let data = [...initialData];
      
      // Starting from where the initial data ended
      currentDate = new Date('2020-01-16');
      
      while (currentDate <= endDate) {
        // Skip weekends
        if (currentDate.getDay() === 0 || currentDate.getDay() === 6) {
          currentDate.setDate(currentDate.getDate() + 1);
          continue;
        }
        
        // Simulate price movements
        const randomChange = (Math.random() - 0.48) * 0.2; // Slight upward bias
        const close = Math.max(0.01, previousClose * (1 + randomChange));
        
        // Create some variation in the open, high, low
        const open = close * (1 + (Math.random() - 0.5) * 0.03);
        const high = Math.max(open, close) * (1 + Math.random() * 0.02);
        const low = Math.min(open, close) * (1 - Math.random() * 0.02);
        
        // Simulate volume with some spikes
        const volumeBase = 5000000 + Math.random() * 10000000;
        const volume = Math.abs(randomChange) > 0.1 ? volumeBase * 2 : volumeBase;
        
        data.push({
          date: currentDate.toISOString().split('T')[0],
          open: parseFloat(open.toFixed(2)),
          high: parseFloat(high.toFixed(2)),
          low: parseFloat(low.toFixed(2)),
          close: parseFloat(close.toFixed(2)),
          volume: Math.round(volume)
        });
        
        previousClose = close;
        currentDate.setDate(currentDate.getDate() + 1);
      }
      
      return data;
    }
    
    // Initialize data and chart on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Generate a large dataset
      fullData = generateHistoricalData();
      
      // Add percent change calculation
      fullData = fullData.map((item, index, arr) => {
        if (index > 0) {
          const prevClose = arr[index - 1].close;
          item.change = parseFloat(((item.close - prevClose) / prevClose * 100).toFixed(2));
        } else {
          item.change = 0;
        }
        return item;
      });
      
      // Sort data by date ascending
      fullData.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      // Set initial timeframe (30 days)
      applyTimeframe(30);
      
      // Initial render of chart, stats, and table
      updateChart();
      updateStats();
      updateDataTable();
      
      // Only data type and granularity (timeframe) controls remain
      document.getElementById('dataType').addEventListener('change', function() {
        updateChart();
        updateStats();
        updateDataTable();
      });
      
      document.querySelectorAll('.timeframe-button').forEach(button => {
        button.addEventListener('click', function() {
          // Reset pagination to first page on timeframe change
          currentPage = 1;
          document.querySelectorAll('.timeframe-button').forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          const days = this.dataset.days;
          if (days === 'all') {
            displayData = [...fullData];
          } else {
            applyTimeframe(parseInt(days));
          }
          
          updateChart();
          updateStats();
          updateDataTable();
        });
      });
    });
    
    function applyTimeframe(days) {
      const cutoffDate = new Date();
      cutoffDate.setDate(cutoffDate.getDate() - days);
      const cutoffDateStr = cutoffDate.toISOString().split('T')[0];
      displayData = fullData.filter(item => item.date >= cutoffDateStr);
    }
    
    function updateChart() {
      const dataType = document.getElementById('dataType').value;
      const ctx = document.getElementById('stockChart').getContext('2d');
      
      // Destroy previous chart if it exists
      if (stockChart) {
        stockChart.destroy();
      }
      
      // Show loading indicator
      document.getElementById('loadingIndicator').classList.remove('hidden');
      
      // Short delay to allow UI update
      setTimeout(() => {
        // Always create a line chart
        stockChart = createLineChart(ctx, displayData, dataType);
        document.getElementById('loadingIndicator').classList.add('hidden');
      }, 100);
    }
    
    function createLineChart(ctx, data, dataType) {
      const chartData = {
        labels: data.map(item => item.date),
        datasets: [{
          label: dataType.charAt(0).toUpperCase() + dataType.slice(1) + ' Price',
          data: data.map(item => item[dataType]),
          borderColor: '#2563eb',
          backgroundColor: 'rgba(37, 99, 235, 0.1)',
          fill: true,
          tension: 0.1,
          pointRadius: data.length > 100 ? 0 : 2,
          pointHoverRadius: 4
        }]
      };
      
      return new Chart(ctx, {
        type: 'line',
        data: chartData,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            intersect: false,
            mode: 'index'
          },
          scales: {
            x: {
              type: 'time',
              time: {
                unit: getTimeUnit(data.length)
              },
              ticks: {
                maxRotation: 0,
                autoSkip: true
              }
            },
            y: {
              beginAtZero: false
            }
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.dataset.label}: $${context.raw.toFixed(2)}`;
                },
                afterBody: function(tooltipItems) {
                  const item = data[tooltipItems[0].dataIndex];
                  return [
                    `Open: $${item.open.toFixed(2)}`,
                    `High: $${item.high.toFixed(2)}`,
                    `Low: $${item.low.toFixed(2)}`,
                    `Close: $${item.close.toFixed(2)}`,
                    `Volume: ${item.volume.toLocaleString()}`
                  ];
                }
              }
            },
            legend: {
              display: true
            }
          }
        }
      });
    }
    
    function getTimeUnit(dataLength) {
      if (dataLength <= 31) return 'day';
      if (dataLength <= 90) return 'week';
      if (dataLength <= 365) return 'month';
      return 'quarter';
    }
    
    function updateStats() {
      if (displayData.length === 0) return;
      const maxPrice = Math.max(...displayData.map(item => item.high));
      const minPrice = Math.min(...displayData.map(item => item.low));
      const avgVolume = Math.round(displayData.reduce((sum, item) => sum + item.volume, 0) / displayData.length);
      const firstPrice = displayData[0].open;
      const lastPrice = displayData[displayData.length - 1].close;
      const periodChange = ((lastPrice - firstPrice) / firstPrice * 100).toFixed(2);
      
      document.getElementById('periodHigh').textContent = '$' + maxPrice.toFixed(2);
      document.getElementById('periodLow').textContent = '$' + minPrice.toFixed(2);
      document.getElementById('avgVolume').textContent = avgVolume.toLocaleString();
      
      const changeElement = document.getElementById('periodChange');
      changeElement.textContent = periodChange + '%';
      changeElement.className = 'stat-value ' + (periodChange >= 0 ? 'positive' : 'negative');
    }
    
    function updateDataTable() {
      const tableBody = document.getElementById('dataTableBody');
      tableBody.innerHTML = '';
      
      // Reverse data for display (newest first)
      const displayDataReversed = [...displayData].reverse();
      const startIndex = (currentPage - 1) * rowsPerPage;
      const endIndex = Math.min(startIndex + rowsPerPage, displayDataReversed.length);
      updatePagination(displayDataReversed.length);
      const pageData = displayDataReversed.slice(startIndex, endIndex);
      
      pageData.forEach(item => {
        const row = document.createElement('tr');
        
        const dateCell = document.createElement('td');
        dateCell.textContent = item.date;
        row.appendChild(dateCell);
        
        const openCell = document.createElement('td');
        openCell.textContent = '$' + item.open.toFixed(2);
        row.appendChild(openCell);
        
        const highCell = document.createElement('td');
        highCell.textContent = '$' + item.high.toFixed(2);
        row.appendChild(highCell);
        
        const lowCell = document.createElement('td');
        lowCell.textContent = '$' + item.low.toFixed(2);
        row.appendChild(lowCell);
        
        const closeCell = document.createElement('td');
        closeCell.textContent = '$' + item.close.toFixed(2);
        row.appendChild(closeCell);
        
        const volumeCell = document.createElement('td');
        volumeCell.textContent = item.volume.toLocaleString();
        row.appendChild(volumeCell);
        
        const changeCell = document.createElement('td');
        changeCell.textContent = item.change + '%';
        changeCell.className = item.change >= 0 ? 'positive' : 'negative';
        row.appendChild(changeCell);
        
        tableBody.appendChild(row);
      });
    }
    
    function updatePagination(totalItems) {
      const totalPages = Math.ceil(totalItems / rowsPerPage);
      const paginationContainer = document.getElementById('pagination');
      paginationContainer.innerHTML = '';
      
      if (totalPages <= 1) return;
      
      const prevButton = document.createElement('button');
      prevButton.textContent = '«';
      prevButton.disabled = currentPage === 1;
      prevButton.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          updateDataTable();
        }
      });
      paginationContainer.appendChild(prevButton);
      
      const maxButtons = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
      let endPage = Math.min(totalPages, startPage + maxButtons - 1);
      
      if (endPage - startPage + 1 < maxButtons) {
        startPage = Math.max(1, endPage - maxButtons + 1);
      }
      
      for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement('button');
        pageButton.textContent = i;
        if (i === currentPage) {
          pageButton.classList.add('active');
        }
        pageButton.addEventListener('click', () => {
          currentPage = i;
          updateDataTable();
        });
        paginationContainer.appendChild(pageButton);
      }
      
      const nextButton = document.createElement('button');
      nextButton.textContent = '»';
      nextButton.disabled = currentPage === totalPages;
      nextButton.addEventListener('click', () => {
        if (currentPage < totalPages) {
          currentPage++;
          updateDataTable();
        }
      });
      paginationContainer.appendChild(nextButton);
    }
  </script>
</body>
</html>
